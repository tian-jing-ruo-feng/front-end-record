<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>镜像构建 | 天净若风 の 前端笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="天净若风的记录前端">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/front-end-record/assets/css/0.styles.0bd3a692.css" as="style"><link rel="preload" href="/front-end-record/assets/js/app.65ada326.js" as="script"><link rel="preload" href="/front-end-record/assets/js/2.b3e11e55.js" as="script"><link rel="preload" href="/front-end-record/assets/js/3.439506d9.js" as="script"><link rel="prefetch" href="/front-end-record/assets/js/10.e381101d.js"><link rel="prefetch" href="/front-end-record/assets/js/11.efe08526.js"><link rel="prefetch" href="/front-end-record/assets/js/12.b45338f2.js"><link rel="prefetch" href="/front-end-record/assets/js/13.76cd0127.js"><link rel="prefetch" href="/front-end-record/assets/js/14.7bc1cfaf.js"><link rel="prefetch" href="/front-end-record/assets/js/15.78704727.js"><link rel="prefetch" href="/front-end-record/assets/js/16.acfb1301.js"><link rel="prefetch" href="/front-end-record/assets/js/17.63bace34.js"><link rel="prefetch" href="/front-end-record/assets/js/18.e7a7c100.js"><link rel="prefetch" href="/front-end-record/assets/js/19.32d54343.js"><link rel="prefetch" href="/front-end-record/assets/js/20.07dc7bd4.js"><link rel="prefetch" href="/front-end-record/assets/js/21.feee165c.js"><link rel="prefetch" href="/front-end-record/assets/js/22.48de0efc.js"><link rel="prefetch" href="/front-end-record/assets/js/23.4db689f8.js"><link rel="prefetch" href="/front-end-record/assets/js/24.c79621db.js"><link rel="prefetch" href="/front-end-record/assets/js/25.a0b53067.js"><link rel="prefetch" href="/front-end-record/assets/js/26.ed12b312.js"><link rel="prefetch" href="/front-end-record/assets/js/27.30170b34.js"><link rel="prefetch" href="/front-end-record/assets/js/28.307937cf.js"><link rel="prefetch" href="/front-end-record/assets/js/29.12dec2cb.js"><link rel="prefetch" href="/front-end-record/assets/js/30.c1ebaf4b.js"><link rel="prefetch" href="/front-end-record/assets/js/31.f19e84e4.js"><link rel="prefetch" href="/front-end-record/assets/js/32.e516dbe6.js"><link rel="prefetch" href="/front-end-record/assets/js/33.ddbff936.js"><link rel="prefetch" href="/front-end-record/assets/js/34.49ea316a.js"><link rel="prefetch" href="/front-end-record/assets/js/35.a2622be3.js"><link rel="prefetch" href="/front-end-record/assets/js/36.6808352c.js"><link rel="prefetch" href="/front-end-record/assets/js/37.71757c77.js"><link rel="prefetch" href="/front-end-record/assets/js/4.79be6ffe.js"><link rel="prefetch" href="/front-end-record/assets/js/5.b453b286.js"><link rel="prefetch" href="/front-end-record/assets/js/6.c8609ea1.js"><link rel="prefetch" href="/front-end-record/assets/js/7.140b43b2.js"><link rel="prefetch" href="/front-end-record/assets/js/8.86283c33.js"><link rel="prefetch" href="/front-end-record/assets/js/9.94355e58.js">
    <link rel="stylesheet" href="/front-end-record/assets/css/0.styles.0bd3a692.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/front-end-record/" class="home-link router-link-active"><!----> <span class="site-name">天净若风 の 前端笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/front-end-record/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/front-end-record/docker/" class="nav-link router-link-active">
  Docker
</a></div><div class="nav-item"><a href="/front-end-record/antvx6/" class="nav-link">
  AntV X6
</a></div><div class="nav-item"><a href="/front-end-record/ts/" class="nav-link">
  TypeScript
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript设计模式" class="dropdown-title"><span class="title">JavaScript设计模式</span> <span class="arrow down"></span></button> <button type="button" aria-label="JavaScript设计模式" class="mobile-dropdown-title"><span class="title">JavaScript设计模式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-end-record/designmode/intro/" class="nav-link">
  灵活的JavaScript
</a></li><li class="dropdown-item"><h4>
          创建型设计模式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  工厂模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  建造者模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  原型模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  单例模式
</a></li></ul></li><li class="dropdown-item"><h4>
          结构型设计模式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  外观模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  适配器模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  代理模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  装饰者模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  桥接模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  组合模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  享元模式
</a></li></ul></li><li class="dropdown-item"><h4>
          行为型设计模式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  模版方法模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  观察者模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  状态模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  策略模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  职责链模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  命令模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  访问者模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  中介者者模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  备忘录模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  迭代器模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  解释器模式
</a></li></ul></li><li class="dropdown-item"><h4>
          技巧型设计模式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  链模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  委托模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  数据访问
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  节流模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  简单模版模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  惰性模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  参与者模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  等待者模式
</a></li></ul></li><li class="dropdown-item"><h4>
          架构型设计模式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  同步模块模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  异步模块模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  Widget模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  MVC模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  MVP模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  MVVM模式
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Pinia" class="dropdown-title"><span class="title">Pinia</span> <span class="arrow down"></span></button> <button type="button" aria-label="Pinia" class="mobile-dropdown-title"><span class="title">Pinia</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-end-record/pinia/" class="nav-link">
  Pinia系统学习
</a></li></ul></div></div><div class="nav-item"><a href="/front-end-record/face-to-face/" class="nav-link">
  面经
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><span class="title">关于</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于" class="mobile-dropdown-title"><span class="title">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-end-record/about/" class="nav-link">
  简介
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/front-end-record/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/front-end-record/docker/" class="nav-link router-link-active">
  Docker
</a></div><div class="nav-item"><a href="/front-end-record/antvx6/" class="nav-link">
  AntV X6
</a></div><div class="nav-item"><a href="/front-end-record/ts/" class="nav-link">
  TypeScript
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript设计模式" class="dropdown-title"><span class="title">JavaScript设计模式</span> <span class="arrow down"></span></button> <button type="button" aria-label="JavaScript设计模式" class="mobile-dropdown-title"><span class="title">JavaScript设计模式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-end-record/designmode/intro/" class="nav-link">
  灵活的JavaScript
</a></li><li class="dropdown-item"><h4>
          创建型设计模式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  工厂模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  建造者模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  原型模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  单例模式
</a></li></ul></li><li class="dropdown-item"><h4>
          结构型设计模式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  外观模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  适配器模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  代理模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  装饰者模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  桥接模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  组合模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  享元模式
</a></li></ul></li><li class="dropdown-item"><h4>
          行为型设计模式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  模版方法模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  观察者模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  状态模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  策略模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  职责链模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  命令模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  访问者模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  中介者者模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  备忘录模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  迭代器模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  解释器模式
</a></li></ul></li><li class="dropdown-item"><h4>
          技巧型设计模式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  链模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  委托模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  数据访问
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  节流模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  简单模版模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  惰性模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  参与者模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  等待者模式
</a></li></ul></li><li class="dropdown-item"><h4>
          架构型设计模式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  同步模块模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  异步模块模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  Widget模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  MVC模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  MVP模式
</a></li><li class="dropdown-subitem"><a href="/front-end-record/designmode/factory-mode.html" class="nav-link">
  MVVM模式
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Pinia" class="dropdown-title"><span class="title">Pinia</span> <span class="arrow down"></span></button> <button type="button" aria-label="Pinia" class="mobile-dropdown-title"><span class="title">Pinia</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-end-record/pinia/" class="nav-link">
  Pinia系统学习
</a></li></ul></div></div><div class="nav-item"><a href="/front-end-record/face-to-face/" class="nav-link">
  面经
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><span class="title">关于</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于" class="mobile-dropdown-title"><span class="title">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-end-record/about/" class="nav-link">
  简介
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Docker</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/front-end-record/docker/" aria-current="page" class="sidebar-link">Docker</a></li><li><a href="/front-end-record/docker/01-镜像构建.html" class="active sidebar-link">镜像构建</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front-end-record/docker/01-镜像构建.html#docker-commit" class="sidebar-link">docker commit</a></li><li class="sidebar-sub-header"><a href="/front-end-record/docker/01-镜像构建.html#dockerfile文件构建-推荐" class="sidebar-link">dockerfile文件构建（推荐）</a></li><li class="sidebar-sub-header"><a href="/front-end-record/docker/01-镜像构建.html#镜像构建并上传镜像" class="sidebar-link">镜像构建并上传镜像</a></li><li class="sidebar-sub-header"><a href="/front-end-record/docker/01-镜像构建.html#搭建本地registry" class="sidebar-link">搭建本地Registry</a></li><li class="sidebar-sub-header"><a href="/front-end-record/docker/01-镜像构建.html#容器运行" class="sidebar-link">容器运行</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="镜像构建"><a href="#镜像构建" class="header-anchor">#</a> 镜像构建</h1> <h2 id="docker-commit"><a href="#docker-commit" class="header-anchor">#</a> <strong>docker commit</strong></h2> <ol><li><p>运行容器</p></li> <li><p>修改容器</p></li> <li><p>将容器保存为新镜像</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> commit <span class="token punctuation">[</span>新镜像名称<span class="token punctuation">]</span> <span class="token punctuation">[</span>源镜像名称<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ol> <h2 id="dockerfile文件构建-推荐"><a href="#dockerfile文件构建-推荐" class="header-anchor">#</a> <strong>dockerfile文件构建</strong>（推荐）</h2> <blockquote><p><code>dockerfile</code>是一个文本文件，里边记录了构建镜像的所有步骤</p> <p><code>dockerfile</code>支持以&quot;#&quot;开头的注释</p> <p>docker build 构建过程 默认会使用构建过镜像的缓存（镜像的缓存特性：构建镜像时，如果某镜像层已经存在，就直接使用，无需重新创建）</p> <p>docker build --no-cache[不使用缓存]</p> <p><code>dockerfile</code>调试：可以在RUN 命令后边 echo “备注信息”，来查看命令执行到哪一步，进而排查问题。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> build <span class="token parameter variable">-t</span> <span class="token punctuation">[</span>新镜像名称<span class="token punctuation">]</span> <span class="token punctuation">[</span>dockerfile文件<span class="token punctuation">]</span>
<span class="token comment">### -t: 构建镜像名称</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></blockquote> <ol><li><p>从base镜像运行一个容器</p></li> <li><p>执行一条指令，修改容器</p></li> <li><p>执行类型docker commit 操作，生成一个新的镜像层</p></li> <li><p>Docker 基于刚刚提交的镜像运行一个 新的容器</p></li> <li><p>重复 2 ~ 4 步骤，直至 <code>Dockerfile</code>中的所有指令执行完毕</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token comment"># my dockerfile</span>
<span class="token instruction"><span class="token keyword">FROM</span> busybox</span>
<span class="token instruction"><span class="token keyword">RUN</span> touch tmpfile</span>
<span class="token instruction"><span class="token keyword">RUN</span> /bin/bash -c echo <span class="token string">&quot;continue to build&quot;</span></span>
<span class="token instruction"><span class="token keyword">COPY</span> testfile/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ol> <h3 id="dockerfile常用命令"><a href="#dockerfile常用命令" class="header-anchor">#</a> <code>Dockerfile</code>常用命令</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>FROM: 指定base镜像
MAINTAINER：设置镜像的作者，可以是任意字符
COPY：将文件从build context复制到镜像
	COPY支持两种形式： COPY src dest 与 COPY [&quot;src&quot;, &quot;dest&quot;]
	注意：src只能指定build context 中的文件或者目录
ADD：将文件从build context复制到镜像
	ADD src dest 或者 ADD [&quot;src&quot;, &quot;dest&quot;]
	区别COPY：如果src是归档文件（tar、zip、tgz、xz等）， 文件会被自动解压到dest
ENV：设置环境变量。环境变量会被后边的命令使用
	例如：ENV MY_VERSION 1.5 RUN apt-get install -y mypackage=$MY_VERSION
EXPOSE：指定容器中的进程会监听某个端口，Docker可以将该关口暴露出来
VOLUME：将文件或目录声明为volume
WORKDIR：为后面的RUN、CMD、ENTRYPOINT、ADD或COPY 指令设置镜像中的 当前工作目录
RUN：在容器中运行指定的命令
CMD：容器启动时运行指定的命令
	Dockerfile中可以有多个CMD指令，但是只有最后一个可以生效。CMD可以被docker run 之后的参数替换
ENTRYPOINT：设置容器启动时运行的命令
	Dockerfile可以有多个ENTRYPOINT命令，但只有最后一个生效。CMD或docker run后边的参数 会被当作参数传递给ENTRYPOINT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="镜像构建并上传镜像"><a href="#镜像构建并上传镜像" class="header-anchor">#</a> 镜像构建并上传镜像</h2> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 登录docker 账号，并输入密码</span>
<span class="token function">docker</span> log <span class="token parameter variable">-u</span> <span class="token punctuation">[</span>docker账号<span class="token punctuation">]</span>
<span class="token comment"># 修改镜像的Repository, 使之与dockhub 账号匹配 tjrf/httpd:1 =&gt; [用户账号]/[image]:[指定tag]</span>
<span class="token function">docker</span> tag http tjrf/httpd:1
<span class="token comment"># 通过docker push将镜像上传到Docker Hub</span>
<span class="token function">docker</span> push tjrf/httpd:1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="搭建本地registry"><a href="#搭建本地registry" class="header-anchor">#</a> 搭建本地Registry</h2> <blockquote><p>镜像名称：repository + tag组成</p> <p>repository完整路径：[registry-host]:[port]/[username]/xxx</p> <p>注意：只有Docker Hub上的镜像可以省略[registry-host]:[port]</p> <p>registry 支持 https安全传输等特性，可参照官方文档</p></blockquote> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 启动Registry容器</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">5000</span>:5000 <span class="token parameter variable">-v</span> /myregistry:/var/lib/registry registry:2
<span class="token comment"># docker tag 重命名镜像，使之与registry匹配 [registry.example.net 需要再host上配置本地对应的host，例如本地[127.0.0.1: registry.example.net]</span>
<span class="token function">docker</span> tag tjrf/httpd:latest registry.example.net:5000/tjrf/httpd:latest
<span class="token comment"># docker push 上传到本地镜像</span>
<span class="token function">docker</span> push registry.example.net:5000/tjrf/httpd:latest
<span class="token comment"># docker pull 拉取本地镜像</span>
<span class="token function">docker</span> pull registry.example.net:5000/tjrf/httpd:latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h1 id="docker-容器"><a href="#docker-容器" class="header-anchor">#</a> Docker 容器</h1> <h2 id="容器运行"><a href="#容器运行" class="header-anchor">#</a> 容器运行</h2> <h3 id="容器长期运行"><a href="#容器长期运行" class="header-anchor">#</a> 容器长期运行</h3> <p><img src="/front-end-record/assets/img/docker-container.736c353b.jpg" alt="image-20231218143812288"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 仅仅是启动容器，并未干实际的事情</span>
<span class="token function">docker</span> run ubuntu /bin/bash <span class="token parameter variable">-c</span> <span class="token string">'while true; do sleep 1; done'</span>
<span class="token comment"># -d 后台运行[推荐]</span>
<span class="token function">docker</span> run ubuntu <span class="token parameter variable">-d</span>
<span class="token comment"># --name 为容器命名</span>
<span class="token function">docker</span> run ubuntu <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> my-ubuntu
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="停止容器"><a href="#停止容器" class="header-anchor">#</a> 停止容器</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> stop <span class="token punctuation">[</span>CONTAINER_ID<span class="token punctuation">]</span> <span class="token comment"># CONTAINTER_ID 容器ID</span>
<span class="token comment"># 或者</span>
<span class="token function">docker</span> stop <span class="token punctuation">[</span>NAMES<span class="token punctuation">]</span> <span class="token comment"># NAMES 容器名称</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="进入容器"><a href="#进入容器" class="header-anchor">#</a> 进入容器</h3> <p><img src="/front-end-record/assets/img/01.3697b9a5.jpg" alt="image-20231218150434799"></p> <ol><li>docker attach</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-itd</span> ubuntu /bin/bash <span class="token parameter variable">-c</span> <span class="token string">&quot;while true; do sleep 1; echo I_am_in_container; done&quot;</span>
<span class="token function">docker</span> attach <span class="token punctuation">[</span>CONTAINER_ID<span class="token punctuation">]</span>
<span class="token comment"># ctrl + p, ctrl + q 退出，必须以交互命令-it进入，否则无法退出</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="/front-end-record/assets/img/02.94fbb63a.jpg" alt="image-20231218151505786"></p> <ol start="2"><li><p>docker exec</p> <blockquote><p>-it：以交互模式打开 pseudo-TTY（虚拟交互终端，TTY（teletypewriter）），执行bash， 结果就是打开一个bash终端</p> <p>ps -elf：显示容器启动进程while以及当前的bash进程</p> <p>exit：退出容器</p></blockquote> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> <span class="token punctuation">[</span>CONTAINER_ID<span class="token punctuation">]</span> <span class="token function">bash</span><span class="token operator">|</span><span class="token function">sh</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ol> <h4 id="docker-attach-vs-docker-exec"><a href="#docker-attach-vs-docker-exec" class="header-anchor">#</a> docker attach VS docker exec</h4> <ul><li>docker attach 直接进入容器启动命令的中终端，不会启动新的进程。</li> <li>docker exec 是在容器中打开新的终端，并且可以启动新的进程。</li> <li>希望直接在启动终端中查看命令的输出，使用attach, 其他则使用exec</li> <li>可以直接使用docker logs -f [CONTAINER_ID]查看命令输出。-f，类似tail -f ，持续打印输入</li></ul> <h1 id="docker网络"><a href="#docker网络" class="header-anchor">#</a> Docker网络</h1> <h1 id="docker-存储"><a href="#docker-存储" class="header-anchor">#</a> Docker 存储</h1> <h1 id="每日命令"><a href="#每日命令" class="header-anchor">#</a> 每日命令</h1> <ol><li><p><code>-it</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>-it: 以交互模式进入容器，并打开终端
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>docker history</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> history: 查看镜像的构建历史（过程）
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>docker tag 给镜像打tag</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker tag [当前镜像] [新镜像名称]:[tag名称]
例如：docker tag mongo:latest my_mongo:1.0.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>docker rmi 删除本地host镜像</p> <blockquote><ol><li>只删除host的镜像，不会删除registry的镜像</li> <li>如果镜像有多个tag，只有删除了所有的对应的tag的镜像，镜像才真正被删除，否则只是删除了镜像对应的tag</li></ol></blockquote> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> rmi registry.example.net:5000/tjrf/httpd:latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>docker search  搜索Docker Hub中的镜像</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> search httpd
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>docker ps [ docker container ls ] 查看当前Docker host 中运行的 container</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 查看运行中的container</span>
<span class="token function">docker</span> <span class="token function">ps</span>
<span class="token comment"># 或者</span>
<span class="token function">docker</span> container <span class="token function">ls</span>
<span class="token comment"># 查看所有状态的container</span>
<span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span>
<span class="token function">docker</span> container <span class="token function">ls</span> <span class="token parameter variable">-a</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">a year ago</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/front-end-record/docker/" class="prev router-link-active">
        Docker
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/front-end-record/assets/js/app.65ada326.js" defer></script><script src="/front-end-record/assets/js/2.b3e11e55.js" defer></script><script src="/front-end-record/assets/js/3.439506d9.js" defer></script>
  </body>
</html>
